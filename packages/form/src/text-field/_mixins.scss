////
/// @group form-text-field
////

@import '@react-md/icon/dist/mixins';
@import '@react-md/transition/dist/mixins';
@import '@react-md/typography/dist/mixins';
@import '@react-md/theme/dist/mixins';
@import '@react-md/utils/dist/mixins';
@import '../variables';
@import '../functions';

/// @access private
@mixin rmd-text-field-container {
  @include rmd-transition(standard);
  @include rmd-form-theme(height, text-height);

  align-items: center;
  display: flex;
  position: relative;
  transition: border-color $rmd-transition-standard-time;

  &:hover {
    @include rmd-form-theme(border-color, text-border-hover-color);
  }

  &--inline {
    display: inline-flex;
  }

  &--label {
    @include rmd-form-theme-update-var(text-height, rmd-form-theme-var(text-label-height));
  }

  &--dense {
    @include rmd-form-theme-update-var(
      text-height,
      rmd-form-theme-var(text-placeholder-dense-height)
    );
  }

  &--dense-label {
    @include rmd-form-theme-update-var(text-height, rmd-form-theme-var(text-label-dense-height));
  }

  &--underline {
    @if $rmd-text-field-underline-padding {
      @include rmd-form-theme-update-var(text-padding-left, $rmd-text-field-underline-padding);
      @include rmd-form-theme-update-var(text-padding-right, $rmd-text-field-underline-padding);
    }
    @include rmd-form-theme(border-color, text-border-color);

    border-bottom-style: solid;
    border-bottom-width: $rmd-text-field-border-width;

    &::after {
      @include rmd-transition(standard);
      @include rmd-form-theme(background-color, text-active-color);

      bottom: -$rmd-text-field-border-width;
      content: '';
      height: $rmd-text-field-border-width-active;
      left: 0;
      position: absolute;
      right: 0;
      transform: scale(0);
      transition: transform $rmd-transition-standard-time;
      z-index: 1;
    }
  }

  &--filled {
    @include rmd-form-theme-update-var(text-padding-left, $rmd-text-field-filled-padding);
    @include rmd-form-theme-update-var(text-padding-right, $rmd-text-field-filled-padding);
    @include rmd-form-theme-update-var(label-left-offset, $rmd-text-field-filled-padding);
    @include rmd-form-theme(background-color, text-filled-color);
    @include rmd-states-surface;

    border-top-left-radius: $rmd-text-field-filled-border-radius;
    border-top-right-radius: $rmd-text-field-filled-border-radius;
  }

  &--underline-left::after {
    transform-origin: left;
  }

  &--underline-center::after {
    transform-origin: center;
  }

  &--underline-right::after {
    transform-origin: right;
  }

  &--underline-active::after {
    transform: scale(1);
  }

  &--underline-left-addon {
    $calc-string: '#{rmd-icon-theme-var(size)} + #{$rmd-text-field-underline-label-left-offset * 2}';
    @if $rmd-text-field-underline-padding {
      $calc-string: '#{$calc-string} + #{$rmd-text-field-underline-padding}';
    }

    @include rmd-form-theme-update-var(text-padding-left, calc(#{$calc-string}));
    @include rmd-form-theme-update-var(
      label-left-offset,
      $rmd-text-field-underline-label-left-offset
    );
  }

  &--outline {
    @include rmd-form-theme-update-var(text-padding-left, $rmd-text-field-outline-padding);
    @include rmd-form-theme-update-var(text-padding-right, $rmd-text-field-outline-padding);
    @include rmd-form-theme-update-var(
      label-left-offset,
      $rmd-text-field-outline-padding - $rmd-label-floating-padding
    );
    @include rmd-form-theme-update-var(label-top-offset, -50%);
    @include rmd-form-theme-update-var(label-active-padding, 0 $rmd-label-floating-padding);
    @include rmd-form-theme-update-var(label-active-background-color, rmd-theme-var(background));
    @include rmd-form-theme(border-color, text-border-color);

    border-radius: $rmd-text-field-border-radius;
    border-style: solid;
    border-width: $rmd-text-field-border-width;

    &::after {
      @include rmd-transition(standard);
      @include rmd-utils-pseudo-element;

      box-shadow: 0 0 0 $rmd-text-field-border-width-active rmd-form-theme-var(text-active-color);
      opacity: 0;
      transition: opacity $rmd-transition-standard-time;
    }
  }

  &--outline-active::after {
    opacity: 1;
  }

  &--outline-left {
    $outline-offset: calc(#{rmd-icon-theme-var(size)} + #{$rmd-text-field-outline-padding * 2});

    @include rmd-form-theme-update-var(text-padding-left, $outline-offset);
  }
}

/// A simple mixin that applies placeholder styles to an input/textarea
/// element.
@mixin rmd-text-field-placeholder {
  &::-webkit-input-placeholder {
    @content;
  }

  &:-ms-input-placeholder {
    @content;
  }

  &::-moz-placeholder {
    @content;
  }

  &:-moz-placeholder {
    @content;
  }

  &:placeholder {
    @content;
  }
}

/// Creates the base styles for a text field so that it gains the
/// correct typography and a few different colors based on its state.
@mixin rmd-text-field-base {
  @include rmd-typography(body-1, font-size);
  @include rmd-utils-hide-focus-outline;
  @include rmd-text-field-placeholder {
    @include rmd-transition(standard);
    @include rmd-theme(color, text-secondary-on-background);

    // want to gain the same font styles as the input/textarea itself,
    // just apply different colors as needed instead
    font: inherit;
  }

  background-color: transparent;
  border-width: 0;
  color: inherit;
  flex-grow: 1;
  flex-shrink: 1;
  font-size: 1em;
  width: 100%;

  &[disabled] {
    @include rmd-theme(color, text-disabled-on-background);

    @include rmd-text-field-placeholder {
      @include rmd-theme(color, text-disabled-on-background);
    }
  }
}

/// @access private
@mixin rmd-text-field {
  @include rmd-utils-rtl {
    @include rmd-form-theme(padding-left, text-padding-right);
    @include rmd-form-theme(padding-right, text-padding-left);
  }
  @include rmd-form-theme(padding-left, text-padding-left);
  @include rmd-form-theme(padding-right, text-padding-right);
  @include rmd-text-field-base;

  height: 100%;

  &--label-underline {
    padding-top: $rmd-text-field-underline-label-padding-top;
  }

  &--placeholder-underline {
    padding-top: $rmd-text-field-underline-placeholder-padding-top;
  }

  &--floating {
    @include rmd-text-field-placeholder {
      color: transparent;
      transition: color $rmd-transition-standard-time;
    }

    &:focus {
      @include rmd-text-field-placeholder {
        @include rmd-theme(color, text-secondary-on-background);
      }
    }
  }
}

/// @access private
@mixin rmd-text-field-addon {
  position: absolute;

  &--first {
    @include rmd-utils-rtl-auto(left, $rmd-text-field-outline-padding);
    @include rmd-icon-theme(height, size);
    @include rmd-icon-theme(width, size);

    pointer-events: none;
  }

  &--first-offset {
    @include rmd-utils-rtl-auto(left, 0.5rem);
  }

  &--last {
    @include rmd-utils-rtl-auto(right, $rmd-text-field-button-offset);
    @include rmd-button-theme-update-var(icon-size, $rmd-text-field-button-size);
  }

  &--underline-offset {
    top: 1.5rem;
  }
}

/// @access private
@mixin react-md-text-field {
  .rmd-text-field-container {
    @include rmd-text-field-container;
  }

  .rmd-text-field {
    @include rmd-text-field;
  }

  .rmd-text-field-addon {
    @include rmd-text-field-addon;
  }
}
